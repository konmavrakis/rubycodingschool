<div class="bs-callout bs-callout-info">
  <ul class="list-inline lists">
    <li><p class="lead"><span class="glyphicon glyphicon glyphicon-user"></span> <%= User.find(List.find(@list.id).user_id).name %></p></li>
    <li><p class="lead"><span class="glyphicon glyphicon glyphicon-th-list"></span> <%= @list.name %></p></li>
    <li>
      <p class="lead"><span class="glyphicon glyphicon glyphicon-globe"></span>
        <%if @list.active%>
          Active
        <%else%>
          Inactive
        <%end%>
      </p>
    </li>
    <li><p class="lead"><span class="glyphicon glyphicon glyphicon-shopping-cart"></span> <%= number_with_precision(@total_price, precision: 2) %>â‚¬</p></li>
    <li>
    <a href="javascript:;;" 
            data-list-id="<%=@list.id%>" 
            <% unless @favorite_list %>
            data-method="post"  
            class="glyphicon glyphicon-heart-empty heartlink"
            data-href="/favorite_lists.json?list_id=<%=@list.id%>"
            <% else %>
            data-method="delete"  
            data-href="/favorite_lists/<%=@favorite_list.id%>.json"
            class="glyphicon glyphicon-heart heartlink" 

            <% end %>
            style="font-size: 20px"></a>
    </li>
 
  </ul>
  <%= rating_for @list, 'name', disable_after_rate: false %>
</div>

<script type="text/javascript">
  $(".heartlink").click(function(){
    var el = $(this);
    var method = el.attr('data-method'); 

    $.ajax({
      method:  method,
      url: el.attr('data-href'),
      dataType: 'json',
      success: function(r) {
        if(r.resp == "ok") {
          if(method == "post") {
            // r.list.id
            el.attr('data-method', 'delete');
            el.attr('data-href', '/favorite_lists/' + r.list.id +'.json');
            el.removeClass('glyphicon-heart-empty').addClass('glyphicon-heart');
          } else {
            el.attr('data-method', 'post');
            el.attr('data-href', '/favorite_lists.json?list_id=' + el.attr('data-list-id'));
            el.removeClass('glyphicon-heart').addClass('glyphicon-heart-empty');
          }

        }
      }
    });

  });

</script>
<div class="text-center">
  <h2>Products</h2>
</div>

<table class="table table-stripped">
  <thead>
    <th>Image</th>
    <th>SKU</th>
    <th>Name</th>
    <th></th>
    <th></th>
  </thead>

  <tbody>
    <% @sku.each do |sku| %>
      <tr>
        <td>
          <img src="<%= sku.images['main'] %>" class="img-responsive" style="max-height: 60px" alt="<%= sku.name %>">
        </td>
        <td><%= sku.id %></td>
        <td><%= sku.name %></td>
        <td><%= link_to 'Show', products_preview_path(sku: sku.id), class: 'btn btn-sm btn-primary' %></td>
        <% if @list.user_id == current_user.id %>
          <td><%= link_to 'Remove', list_removeproduct_path(:sku_id=>sku.id, :list_id=>@list.id, :user_id => @list.user_id), method: :put, data: { confirm: 'Really delete this product from your list?' }, class: 'btn btn-sm btn-danger' %></td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>

<div class="btn-group">
<% if @list.user_id == current_user.id %>
  <%= link_to 'Edit List', edit_list_path(@list), class: 'btn btn-primary' %>
<% end %>
<%= link_to 'Back to Your Lists', lists_path, class: 'btn btn-warning' %>
<%= link_to 'Back to All Lists', root_path, class: 'btn btn-info' %>
</div>
